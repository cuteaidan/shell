#!/usr/bin/env bash
# ===============================================
# Moreanp 彩色登录 Banner 一键安装脚本
# ===============================================

BANNER_PATH="/usr/local/bin/moreanp_banner.sh"

cat > "$BANNER_PATH" <<'EOF'
#!/usr/bin/env bash
clear

# ---------------- 彩色艺术字 ----------------
echo -e "[0;1;31;91m▄[0m    [0;1;36;96m▄[0m                                          "
echo -e "[0;1;33;93m█[0;1;32;92m█[0m  [0;1;36;96m█[0;1;34;94m█[0m  [0;1;35;95m▄[0;1;31;91m▄▄[0m    [0;1;36;96m▄[0m [0;1;34;94m▄▄[0m   [0;1;31;91m▄[0;1;33;93m▄▄[0m    [0;1;34;94m▄▄[0;1;35;95m▄[0m   [0;1;33;93m▄[0m [0;1;32;92m▄▄[0m   [0;1;34;94m▄[0;1;35;95m▄▄[0;1;31;91m▄[0m  "
echo -e "[0;1;32;92m█[0m [0;1;36;96m█[0;1;34;94m█[0m [0;1;35;95m█[0m [0;1;31;91m█▀[0m [0;1;33;93m▀[0;1;32;92m█[0m   [0;1;34;94m█▀[0m  [0;1;31;91m▀[0m [0;1;33;93m█▀[0m  [0;1;36;96m█[0m  [0;1;34;94m▀[0m   [0;1;31;91m█[0m  [0;1;32;92m█▀[0m  [0;1;34;94m█[0m  [0;1;35;95m█[0;1;31;91m▀[0m [0;1;33;93m▀█[0m "
echo -e "[0;1;36;96m█[0m [0;1;34;94m▀[0;1;35;95m▀[0m [0;1;31;91m█[0m [0;1;33;93m█[0m   [0;1;36;96m█[0m   [0;1;35;95m█[0m     [0;1;32;92m█▀[0;1;36;96m▀▀[0;1;34;94m▀[0m  [0;1;35;95m▄[0;1;31;91m▀▀[0;1;33;93m▀█[0m  [0;1;36;96m█[0m   [0;1;35;95m█[0m  [0;1;31;91m█[0m   [0;1;32;92m█[0m "
echo -e "[0;1;34;94m█[0m    [0;1;33;93m█[0m [0;1;32;92m▀█[0;1;36;96m▄█[0;1;34;94m▀[0m   [0;1;31;91m█[0m     [0;1;36;96m▀█[0;1;34;94m▄▄[0;1;35;95m▀[0m  [0;1;31;91m▀[0;1;33;93m▄▄[0;1;32;92m▀█[0m  [0;1;34;94m█[0m   [0;1;31;91m█[0m  [0;1;33;93m█[0;1;32;92m█▄[0;1;36;96m█▀[0m "
echo -e "                                           [0;1;32;92m█[0m     "
echo -e "                                           [0;1;36;96m▀[0m     "
echo
echo -e "                                  Powered by Moreanp     "
echo -e " -------------------------------------------------------"

# ---------------- 系统信息 ----------------
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2+$4+$6+$10+$12+$14+$16}')
CPU_DISPLAY="$CPU_USAGE%"
MEM_USED=$(free -b | awk '/Mem:/ {printf "%.1f", $3/1024/1024/1024}')
MEM_TOTAL=$(free -b | awk '/Mem:/ {printf "%.1f", $2/1024/1024/1024}')
DISK_USED=$(df --block-size=1 / | awk 'NR==2{printf "%.1f", $3/1024/1024/1024}')
DISK_TOTAL=$(df --block-size=1 / | awk 'NR==2{printf "%.1f", $2/1024/1024/1024}')
EXT_IP=$(curl -s --max-time 2 https://api.ipify.org || echo "N/A")

printf " CPU:%-5s | MEM:%-7s | DISK:%-7s | IP:%s\n" "$CPU_DISPLAY" "${MEM_USED}/${MEM_TOTAL}" "${DISK_USED}/${DISK_TOTAL}" "$EXT_IP"
echo -e " -------------------------------------------------------"
EOF

chmod +x "$BANNER_PATH"

# 注册登录自动执行
if ! grep -q "moreanp_banner.sh" ~/.bashrc; then
    echo -e "\n# >>> Moreanp Banner <<<" >> ~/.bashrc
    echo "bash $BANNER_PATH" >> ~/.bashrc
    echo "# >>> End <<<" >> ~/.bashrc
fi

echo -e "\033[1;36m→ 安装完成！下次登录显示彩色 Banner\033[0m"
