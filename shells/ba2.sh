#!/bin/sh
# å®‰è£…ç™»å½•åŽæ˜¾ç¤ºçš„å½©è‰² Bannerï¼ˆä»…æ˜¾ç¤º /etc/bannerï¼Œç¦ç”¨ MOTDï¼‰
BANNER_FILE="/etc/banner"
PROFILE_FILE="/etc/profile"

# 1) å¦‚æžœ /etc/banner ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶ï¼ˆåªå†™é™æ€å›¾æ¡ˆï¼Œä¸å†™åŠ¨æ€ä¿¡æ¯ï¼‰
if [ ! -f "$BANNER_FILE" ]; then
cat > "$BANNER_FILE" <<'EOF'
[0;1;31;91mâ–„[0m    [0;1;36;96mâ–„[0m                                          
[0;1;33;93mâ–ˆ[0;1;32;92mâ–ˆ[0m  [0;1;36;96mâ–ˆ[0;1;34;94mâ–ˆ[0m  [0;1;35;95mâ–„[0;1;31;91mâ–„â–„[0m    [0;1;36;96mâ–„[0m [0;1;34;94mâ–„â–„[0m   [0;1;31;91mâ–„[0;1;33;93mâ–„â–„[0m    [0;1;34;94mâ–„â–„[0;1;35;95mâ–„[0m   [0;1;33;93mâ–„[0m [0;1;32;92mâ–„â–„[0m   [0;1;34;94mâ–„[0;1;35;95mâ–„â–„[0;1;31;91mâ–„[0m  
[0;1;32;92mâ–ˆ[0m [0;1;36;96mâ–ˆ[0;1;34;94mâ–ˆ[0m [0;1;35;95mâ–ˆ[0m [0;1;31;91mâ–ˆâ–€[0m [0;1;33;93mâ–€[0;1;32;92mâ–ˆ[0m   [0;1;34;94mâ–ˆâ–€[0m  [0;1;31;91mâ–€[0m [0;1;33;93mâ–ˆâ–€[0m  [0;1;36;96mâ–ˆ[0m  [0;1;34;94mâ–€[0m   [0;1;31;91mâ–ˆ[0m  [0;1;32;92mâ–ˆâ–€[0m  [0;1;34;94mâ–ˆ[0m  [0;1;35;95mâ–ˆ[0;1;31;91mâ–€[0m [0;1;33;93mâ–€â–ˆ[0m 
[0;1;36;96mâ–ˆ[0m [0;1;34;94mâ–€[0;1;35;95mâ–€[0m [0;1;31;91mâ–ˆ[0m [0;1;33;93mâ–ˆ[0m   [0;1;36;96mâ–ˆ[0m   [0;1;35;95mâ–ˆ[0m     [0;1;32;92mâ–ˆâ–€[0;1;36;96mâ–€â–€[0;1;34;94mâ–€[0m  [0;1;35;95mâ–„[0;1;31;91mâ–€â–€[0;1;33;93mâ–€â–ˆ[0m  [0;1;36;96mâ–ˆ[0m   [0;1;35;95mâ–ˆ[0m  [0;1;31;91mâ–ˆ[0m   [0;1;32;92mâ–ˆ[0m 
[0;1;34;94mâ–ˆ[0m    [0;1;33;93mâ–ˆ[0m [0;1;32;92mâ–€â–ˆ[0;1;36;96mâ–„â–ˆ[0;1;34;94mâ–€[0m   [0;1;31;91mâ–ˆ[0m     [0;1;36;96mâ–€â–ˆ[0;1;34;94mâ–„â–„[0;1;35;95mâ–€[0m  [0;1;31;91mâ–€[0;1;33;93mâ–„â–„[0;1;32;92mâ–€â–ˆ[0m  [0;1;34;94mâ–ˆ[0m   [0;1;31;91mâ–ˆ[0m  [0;1;33;93mâ–ˆ[0;1;32;92mâ–ˆâ–„[0;1;36;96mâ–ˆâ–€[0m 
                                           [0;1;32;92mâ–ˆ[0m     
                                           [0;1;36;96mâ–€[0m     
                                             
                                  Powered by Moreanp    
 -------------------------------------------------------
EOF
fi

# 2) åœ¨ /etc/profile æ·»åŠ è°ƒç”¨é€»è¾‘ï¼ˆé¿å…é‡å¤è¿½åŠ ï¼‰
if ! grep -q '### SHOW /etc/banner ###' "$PROFILE_FILE" 2>/dev/null; then
cat >> "$PROFILE_FILE" <<'EOF'

### SHOW /etc/banner ###
# ä»…äº¤äº’å¼ shell æ‰æ˜¾ç¤º
if [ -n "$PS1" ]; then
    # æ˜¾ç¤ºé™æ€ Banner å›¾æ¡ˆ
    [ -f /etc/banner ] && cat /etc/banner

    # åŠ¨æ€ä¿¡æ¯ï¼šCPUã€å†…å­˜ã€ç¡¬ç›˜å ç”¨ã€å…¬ç½‘ IPï¼ˆå½©è‰²æ˜¾ç¤ºï¼‰
    CPU_INFO=$(awk -F: '/model name/ {print $2; exit}' /proc/cpuinfo | sed 's/^ //')
    MEM_INFO=$(free -h | awk '/^Mem:/ {print $3 "/" $2}')
    DISK_INFO=$(df -h / | awk 'NR==2 {print $3 "/" $2}')
    PUB_IP=$(curl -s4 ifconfig.me || echo "N/A")

    echo -e " \033[1;33mCPU:\033[0m \033[1;36m$CPU_INFO\033[0m | \033[1;33mMEM:\033[0m \033[1;32m$MEM_INFO\033[0m | \033[1;33mDISK:\033[0m \033[1;34m$DISK_INFO\033[0m | \033[1;33mIP:\033[0m \033[1;35m$PUB_IP\033[0m"
    echo -e " \033[1;36m-------------------------------------------------------\033[0m"
fi
### END SHOW /etc/banner ###

EOF
fi

# 3) ç¦ç”¨ MOTDï¼ˆUbuntu ç‰¹æœ‰ï¼‰
# æ³¨é‡Š pam_motd è°ƒç”¨
if [ -f /etc/pam.d/sshd ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/sshd
fi
if [ -f /etc/pam.d/login ]; then
    sed -i 's/^\(session\s\+optional\s\+pam_motd.so.*\)$/# \1/' /etc/pam.d/login
fi

# ç¦ç”¨ update-motd.d è„šæœ¬æ‰§è¡Œæƒé™
if [ -d /etc/update-motd.d ]; then
    chmod -x /etc/update-motd.d/*
fi

echo "âœ…å½©è‰²Bannerå·²é…ç½®å®Œæˆï¼ˆæ¯æ¬¡ç™»å½•åŠ¨æ€æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ï¼Œå·²å±è”½ Ubuntu MOTDï¼‰"
